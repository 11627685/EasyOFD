!function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,u(s.key),s)}}function i(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e,i){return(e=u(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&r(t,e)}function a(t){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},a(t)}function r(t,e){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},r(t,e)}function o(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,s=a(t);if(e){var n=a(this).constructor;i=Reflect.construct(s,arguments,n)}else i=s.apply(this,arguments);return o(this,i)}}function h(){return h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var s=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=a(t)););return t}(t,e);if(s){var n=Object.getOwnPropertyDescriptor(s,e);return n.get?n.get.call(arguments.length<3?t:i):n.value}},h.apply(this,arguments)}function u(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var c=function(){function e(){t(this,e),this.docID="",this.title="",this.author="",this.subject="",this.abstract="",this.creationDate="",this.modDate="",this.docUsage="",this.cover="",this.creator="",this.creatorVersion=""}return i(e,[{key:"ParseFromXml",value:function(t){null!=t.DocID&&(this.docID=t.DocID.toString()),null!=t.Title&&(this.title=t.Title.toString()),null!=t.Author&&(this.author=t.Author.toString()),null!=t.Subject&&(this.subject=t.Subject.toString()),null!=t.Abstract&&(this.abstract=t.Abstract.toString()),null!=t.CreationDate&&(this.creationDate=t.CreationDate.toString()),null!=t.ModDate&&(this.modDate=t.ModDate.toString()),null!=t.DocUsage&&(this.docUsage=t.DocUsage.toString()),null!=t.Cover&&(this.cover=t.Cover.toString()),null!=t.Creator&&(this.creator=t.Creator.toString()),null!=t.CreatorVersion&&(this.creatorVersion=t.CreatorVersion.toString())}}]),e}(),f=function(){function e(){t(this,e),this.physicalBox=null,this.applicationlBox=null,this.contentBox=null,this.bleedBox=null}return i(e,[{key:"ParseFromXml",value:function(t){null!=t.PhysicalBox&&(this.physicalBox={x:0,y:0,w:0,h:0},this.physicalBox=this.Parse(t.PhysicalBox.toString())),null!=t.applicationlBox&&(this.applicationlBox={x:0,y:0,w:0,h:0},this.applicationlBox=this.Parse(t.ApplicationlBox.toString())),null!=t.ContentBox&&(this.contentBox={x:0,y:0,w:0,h:0},this.contentBox=this.Parse(t.ContentBox.toString())),null!=t.BleedBox&&(this.bleedBox={x:0,y:0,w:0,h:0},this.bleedBox=this.Parse(t.BleedBox.toString()))}},{key:"Parse",value:function(t){try{var e=t.split(" ");return{x:parseFloat(e[0]),y:parseFloat(e[1]),w:parseFloat(e[2]),h:parseFloat(e[3])}}catch(t){return null}}}]),e}(),m=function(){function e(){t(this,e),this.width=0,this.height=0,this.xStep=this.width,this.yStep=this.height,this.reflectMethod="Noraml",this.relativeTo="Object",this.cTM=[],this.thumbnail=""}return i(e,[{key:"ParseFromXml",value:function(t){}}]),e}(),d=function(){function e(){t(this,e),this.value=[],this.index=0,this.colorSpace="RGB",this.alpha=255,this.pattern=new m}return i(e,[{key:"GetCtxDrawColor",value:function(){return"RGB"==this.colorSpace||"5"==this.colorSpace||"4"==this.colorSpace?"rgba("+this.value[0]+","+this.value[1]+","+this.value[2]+","+this.alpha/255+")":"Gray"==this.colorSpace?this.value:"rgba(255, 255, 255, 0.0)"}},{key:"ParseFromXml",value:function(t){if(this.value=[],null!=t._Index&&(this.index=parseInt(t._Index)),null!=t._ColorSpace&&(this.colorSpace=t._ColorSpace),null!=t.Pattern&&this.pattern.ParseFromXml(t.Pattern),null!=t._Value)for(var e=t._Value.split(" "),i=0;i<e.length;i++)this.value.push(parseInt(e[i]))}}]),e}(),p=function(){function e(){t(this,e),this.boundary={x:0,y:0,h:0,w:0},this.name="",this.visible=!0,this.cTM=null,this.drawPrarm="",this.lineWidth=.353,this.cap="Butt",this.join="Miter",this.miterLimit=3.528,this.dashOffset=0,this.dashPattern=[],this.actions=[],this.clips=[]}return i(e,[{key:"ParseFromXml",value:function(t){null!=t._Boundary&&(this.boundary=this.Parse(t._Boundary)),null!=t._Name&&(this.name=t._Name.toString()),null!=t._Visible&&(this.visible=!0),null!=t._CTM&&(this.cTM=this.ParseCTM(t._CTM)),null!=t._DrawPrarm&&(this.drawPrarm=t._DrawPrarm.toString()),null!=t._LineWidth&&(this.lineWidth=parseFloat(t._LineWidth.toString())),null!=t._Cap&&(this.cap=t._Cap.toString()),null!=t._Join&&(this.join=t._Join.toString()),null!=t._MiterLimit&&(this.miterLimit=parseFloat(t._MiterLimit.toString())),null!=t._ID&&(this.id=t._ID.toString()),null!=t._DashOffset&&(this.dashOffset=parseFloat(t._DashOffset.toString()))}},{key:"Parse",value:function(t){try{var e=t.split(" ");return{x:parseFloat(e[0]),y:parseFloat(e[1]),w:parseFloat(e[2]),h:parseFloat(e[3])}}catch(t){return{x:0,y:0,w:0,h:0}}}},{key:"ParseCTM",value:function(t){try{var e=t.split(" ");return{a:parseFloat(e[0]),b:parseFloat(e[1]),c:parseFloat(e[2]),d:parseFloat(e[3]),e:parseFloat(e[4]),f:parseFloat(e[5])}}catch(t){return null}}},{key:"MM2PX",value:function(t){return parseFloat(parseFloat(t)/25.4*96)}},{key:"MM2PXCTM",value:function(t){return null==this.cTM?this.MM2PX(t):null!=this.cTM&&0!=this.cTM.a&&0!=this.cTM.b&&0!=this.cTM.c&&0!=this.cTM.d?parseFloat(parseFloat(t)/25.4*96):0==this.cTM.b&&0==this.cTM.c?parseFloat(parseFloat(t)*this.cTM.a/25.4*96):void 0}},{key:"MM2PXX",value:function(t){return parseFloat((parseFloat(t)+this.boundary.x)/25.4*96)}},{key:"MM2PXY",value:function(t){return parseFloat((parseFloat(t)+this.boundary.y)/25.4*96)}},{key:"MM2PXXCTM",value:function(t,e){return null!=this.cTM?null!=this.cTM&&0!=this.cTM.a&&0!=this.cTM.b&&0!=this.cTM.c&&0!=this.cTM.d?this.MM2PXX(t):parseFloat((this.GetCTMX(t,e)+this.boundary.x)/25.4*96):this.MM2PXX(t)}},{key:"MM2PXYCTM",value:function(t,e){return null!=this.cTM?parseFloat((this.GetCTMY(t,e)+this.boundary.y)/25.4*96):this.MM2PXY(e)}},{key:"GetCTMY",value:function(t,e){var i=this.GetCTMXY(t,e);return null!=i?i.y:0}},{key:"GetCTMX",value:function(t,e){var i=this.GetCTMXY(t,e);return null!=i?i.x:0}},{key:"GetCTMXY",value:function(t,e){if(null!=this.cTM){var i={x:t,y:e};return i.x=this.cTM.a*t+this.cTM.b*e+this.cTM.e,i.y=this.cTM.c*t+this.cTM.d*e+this.cTM.f,i}}}]),e}(),v=function(){function e(){t(this,e),this.x=0,this.y=0,this.deltaX=[],this.deltaY=[],this.textValue=""}return i(e,[{key:"Draw",value:function(t,e){var i=e.cTM;if(t.save(),null!=i&&0!=i.a&&0!=i.b&&0!=i.c&&0!=i.d)for(var s=Math.atan2(i.b,i.a),n=e.MM2PXX(0),a=e.MM2PXY(0),r=0;r<this.textValue.length;r++){var o=this.textValue[r];t.translate(n,a),t.rotate(s),t.fillText(o,e.MM2PX(this.x),e.MM2PX(this.y)),this.deltaX.length>0&&this.deltaX.length>r?(n+=e.MM2PX(this.deltaX[r]),this.deltaY.length>0&&(a+=e.MM2PX(this.deltaY[r]))):this.deltaY.length>0&&this.deltaY.length>r&&(a+=e.MM2PXCTM(this.deltaY[r]))}else{var l=e.MM2PXXCTM(this.x,this.y),h=e.MM2PXYCTM(this.x,this.y);for(r=0;r<this.textValue.length;r++){o=this.textValue[r];t.fillText(o,l,h),this.deltaX.length>0&&this.deltaX.length>r?(l+=e.MM2PXCTM(this.deltaX[r]),this.deltaY.length>0&&(h+=e.MM2PXCTM(this.deltaY[r]))):this.deltaY.length>0&&this.deltaY.length>r&&(h+=e.MM2PXCTM(this.deltaY[r]))}}t.restore()}},{key:"ParseFromXml",value:function(t){if(null!=t._X&&(this.x=parseFloat(t._X.toString())),null!=t._Y&&(this.y=parseFloat(t._Y.toString())),null!=t.__text&&(this.textValue=t.__text.toString()),null!=t._DeltaX)for(var e=t._DeltaX.split(" "),i=0;i<e.length;i++){var s=e[i];if("G"==s||"g"==s)for(var n=e[++i],a=parseFloat(e[++i]),r=0;r<n;r++)this.deltaX.push(a);else this.deltaX.push(parseFloat(e[i]))}if(null!=t._DeltaY){var o=t._DeltaY.split(" ");for(i=0;i<o.length;i++){var l=o[i];if("G"==l||"g"==l){var h=o[++i],u=parseFloat(o[++i]);for(r=0;r<h;r++)this.deltaY.push(u)}else this.deltaY.push(parseFloat(o[i]))}}}}]),e}(),g=function(){function e(){t(this,e),this.CodePosition=0,this.CodeCount=1,this.GlyphCount=1,this.Glyphs=[]}return i(e,[{key:"ParseFromXml",value:function(t){if(null!=t._CodePosition&&(this.CodePosition=parseInt(t._CodePosition.toString())),null!=t._CodeCount&&(this.CodeCount=parseInt(t._CodeCount.toString())),null!=t._GlyphCount&&(this.GlyphCount=parseInt(t._GlyphCount.toString())),null!=t.Glyphs)for(var e=t.Glyphs.toString().split(" "),i=0;i<e.length;i++)this.Glyphs.push(parseFloat(e[i]))}}]),e}(),y=function(e){n(r,e);var s=l(r);function r(e){var i;return t(this,r),(i=s.call(this)).commonData=e,i.font="",i.size=0,i.strocke=!1,i.fill=!1,i.hScale=1,i.readDirection=0,i.charDircection=!1,i.weight=400,i.italic=!1,i.fillColor=null,i.strockeColor=null,i.cgTransFrom=[],i.textCode=[],i}return i(r,[{key:"Draw",value:function(t){t.save(),t.font=this.GetFont(),null!=this.fillColor&&(t.fillStyle=this.fillColor.GetCtxDrawColor());for(var e=0;e<this.textCode.length;e++){this.textCode[e].Draw(t,this)}t.restore()}},{key:"GetFont",value:function(){var t=this.weight,e="宋体";if(null!=this.font&&""!=this.font&&null!=this.commonData.GetPublicRes()){var i=this.commonData.GetPublicRes()[0];if(null!=i){var s=i.GetFontByID(this.font);null!=s&&(""!=s.familyName&&(e=s.familyName),""!=s.fontname&&(e=s.fontname),s.italic&&"italic",s.bold&&(t="bold"))}}return(this.italic?"italic":"")+" normal "+t+" "+parseInt(this.MM2PXCTM(this.size))+"px "+e}},{key:"ParseFromXml",value:function(t){if(h(a(r.prototype),"ParseFromXml",this).call(this,t),null!=t._Font&&(this.font=t._Font.toString()),null!=t._Size&&(this.size=parseFloat(t._Size.toString())),null!=t._Strocke&&(this.strocke=!0),null!=t._Fill&&(this.fill=!0),null!=t._HScale&&(this.hScale=parseFloat(t._HScale.toString())),null!=t._ReadDirection&&(this.readDirection=parseInt(t._ReadDirection.toString())),null!=t._CharDircection&&(this.charDircection=parseInt(t._CharDircection.toString())),null!=t._Weight&&(this.weight=parseInt(t._Weight.toString())),null!=t._Italic&&(this.italic=!0),null!=t.FillColor&&(this.fillColor=new d,this.fillColor.ParseFromXml(t.FillColor)),null!=t.TextCode&&Array.isArray(t.TextCode))for(var e=0;e<t.TextCode.length;e++){var i=t.TextCode[e],s=new v;s.ParseFromXml(i),this.textCode.push(s)}else if(null!=t.TextCode){var n=new v;n.ParseFromXml(t.TextCode),this.textCode.push(n)}if(null!=t.CGTransform&&Array.isArray(t.CGTransform))for(e=0;e<t.CGTransform.length;e++){i=t.CGTransform[e];var o=new g;o.ParseFromXml(i),this.cgTransFrom.push(o)}else if(null!=t.CGTransform){var l=new g;l.ParseFromXml(t.CGTransform),this.cgTransFrom.push(l)}}}]),r}(p),P=function(e){n(r,e);var s=l(r);function r(){var e;return t(this,r),(e=s.call(this)).stocke=!0,e.fill=!1,e.rule="NonZero",e.fillColor=new d,e.strokeColor=new d,e.strokeColor.value=[0,0,0],e.abbreviatedData="",e}return i(r,[{key:"Draw",value:function(t){t.save();var e=this.abbreviatedData.split(" "),i=0;this.stocke&&(t.strokeStyle=this.strokeColor.GetCtxDrawColor()),this.fill&&(t.fillStyle=this.fillColor.GetCtxDrawColor()),t.lineWidth=parseInt(this.MM2PXCTM(this.lineWidth)),t.beginPath();for(var s=0,n=0,a=0,r=0;!(i>=e.length);){var o=e[i++];if("M"==o){var l=e[i++],h=e[i++];s=this.MM2PXXCTM(l,h),n=this.MM2PXYCTM(l,h),t.moveTo(s,n)}else if("L"==o){var u=e[i++],c=e[i++];a=this.MM2PXXCTM(u,c),r=this.MM2PXYCTM(u,c),t.lineTo(a,r)}else if("C"==o)t.closePath();else if("B"==o){var f=e[i++],m=e[i++],d=this.MM2PXXCTM(f,m),p=this.MM2PXYCTM(f,m),v=e[i++],g=e[i++],y=this.MM2PXXCTM(v,g),P=this.MM2PXYCTM(v,g),w=e[i++],D=e[i++],b=this.MM2PXXCTM(w,D),S=this.MM2PXYCTM(w,D);t.bezierCurveTo(d,p,y,P,b,S)}else""==o&&i++}this.stocke&&t.stroke(),this.fill&&t.fill(),t.restore()}},{key:"ParseFromXml",value:function(t){h(a(r.prototype),"ParseFromXml",this).call(this,t),null!=t._Stroke&&"true"==t._Stroke?this.stocke=!0:"false"==t._Stroke&&(this.stocke=!1),null!=t._Fill&&(this.fill=!0),null!=t._Rule&&(this.rule=t._Rule.toString()),null!=t.FillColor?(this.fillColor.ParseFromXml(t.FillColor),this.fill=!0):this.fill=!1,null!=t.StrokeColor&&(this.strokeColor.ParseFromXml(t.StrokeColor),this.stocke=!0),null!=t.AbbreviatedData&&(this.abbreviatedData=t.AbbreviatedData.toString())}}]),r}(p),w=function(){function e(){t(this,e),this.lineWidth=.353,this.HorizonalCornerRadius=0,this.VerticalCornerRadius="",this.dashOffset=0,this.dashPattern=[],this.borderColor=new d}return i(e,[{key:"ParseFromXml",value:function(t){}}]),e}(),D=function(e){n(r,e);var s=l(r);function r(e){var i;return t(this,r),(i=s.call(this)).commonData=e,i.resourceID="",i.substitution="",i.imageMask="",i.borer=new w,i}return i(r,[{key:"Draw",value:function(t){var e=this.MM2PXX(0),i=this.MM2PXY(0),s=this.MM2PX(this.boundary.w),n=this.MM2PX(this.boundary.h),a=this.commonData.GetMultiMediasByID(this.resourceID);null!=a&&null!=a.image&&t.drawImage(a.image,e,i,s,n)}},{key:"ParseFromXml",value:function(t){h(a(r.prototype),"ParseFromXml",this).call(this,t),null!=t._Substitution&&(this.substitution=t._Substitution.toString()),null!=t._Size&&(this.size=parseFloat(t._Size.toString())),null!=t._ResourceID&&(this.resourceID=parseFloat(t._ResourceID.toString())),null!=t._ImageMask&&(this.imageMask=parseFloat(t._ImageMask.toString())),null!=t.Border&&this.borer.ParseFromXml(t.Border)}}]),r}(p),b=function(e){n(r,e);var s=l(r);function r(e){return t(this,r),s.call(this,e)}return i(r,[{key:"Draw",value:function(t){h(a(r.prototype),"Draw",this).call(this,t)}},{key:"ParseFromXml",value:function(t){h(a(r.prototype),"ParseFromXml",this).call(this,t)}}]),r}(function(e){n(r,e);var s=l(r);function r(e){var i;return t(this,r),(i=s.call(this,e)).pageBlock={},i.textObject=[],i.pathObject=[],i.imageObject=[],i.CompostieObject=[],i}return i(r,[{key:"Draw",value:function(t){t.save(),this.SetPublicDrawParam(t);for(var e=0;e<this.pathObject.length;e++){this.pathObject[e].Draw(t)}for(e=0;e<this.textObject.length;e++){this.textObject[e].Draw(t)}for(e=0;e<this.imageObject.length;e++){this.imageObject[e].Draw(t)}t.restore()}},{key:"SetPublicDrawParam",value:function(t){if(null!=this.drawParam&&""!=this.drawParam&&null!=this.commonData.GetPublicRes()){var e=this.commonData.GetPublicRes()[0];if(null!=e){var i=e.GetDrawParamByID(this.drawParam);null!=i&&(""!=i.relative&&this.GetParentParam(t,i.relative),i.SetCtx(t))}}}},{key:"GetParentParam",value:function(t,e){if(""!=e){var i=this.commonData.GetPublicRes()[0].GetDrawParamByID(e);null!=i&&(""!=i.relative&&this.GetParentParam(t,i.relative),i.SetCtx(t))}}},{key:"ParseFromXml",value:function(t){if(h(a(r.prototype),"ParseFromXml",this).call(this,t),null!=t.TextObject&&Array.isArray(t.TextObject))for(var e=0;e<t.TextObject.length;e++){var i=t.TextObject[e],s=new y(this.commonData);s.ParseFromXml(i),this.textObject.push(s)}else if(null!=t.TextObject){var n=new y(this.commonData);n.ParseFromXml(t.TextObject),this.textObject.push(n)}if(null!=t.PathObject&&Array.isArray(t.PathObject))for(e=0;e<t.PathObject.length;e++){i=t.PathObject[e];var o=new P(this.commonData);o.ParseFromXml(i),this.pathObject.push(o)}else if(null!=t.PathObject){var l=new P(this.commonData);l.ParseFromXml(t.PathObject),this.pathObject.push(l)}if(null!=t.ImageObject&&Array.isArray(t.ImageObject))for(e=0;e<t.ImageObject.length;e++){i=t.ImageObject[e];var u=new D(this.commonData);u.ParseFromXml(i),this.imageObject.push(u)}else if(null!=t.ImageObject){var c=new D(this.commonData);c.ParseFromXml(t.ImageObject),this.imageObject.push(c)}}}]),r}(function(){function e(i){t(this,e),this.commonData=i,this.type="Body",this.drawParam="",this.id=""}return i(e,[{key:"Draw",value:function(t){}},{key:"ParseFromXml",value:function(t){null!=t._ID&&(this.id=t._ID.toString()),null!=t._Type&&(this.type=t._Type.toString()),null!=t._DrawParam&&(this.drawParam=t._DrawParam.toString())}}]),e}())),S=function(){function e(i){t(this,e),this.commonData=i,this.layers=[]}return i(e,[{key:"Draw",value:function(t){for(var e=0;e<this.layers.length;e++){this.layers[e].Draw(t)}}},{key:"ParseFromXml",value:function(t){if(null!=t.Layer&&Array.isArray(t.Layer))for(var e=0;e<t.Layer.length;e++){var i=t.Layer[e],s=new b(this.commonData);s.ParseFromXml(i),this.layers.push(s)}else if(null!=t.Layer){var n=new b(this.commonData);n.ParseFromXml(t.Layer),this.layers.push(n)}}}]),e}(),F=function(){function e(){t(this,e),this.templateID="",this.zOrder=""}return i(e,[{key:"ParseFromXml",value:function(t){null!=t._TemplateID&&(this.templateID=t._TemplateID.toString()),null!=t._ZOrder&&(this.zOrder=t._ZOrder.toString())}}]),e}(),M=function(){function e(i,s){t(this,e),this.docs=i,this.commonData=s,this.id="",this.baseLoc="",this.template=[],this.area=new f(this.commonData),this.pageRes=[],this.content=[],this.actions=[]}return i(e,[{key:"Draw",value:function(t){for(var e=0;e<this.content.length;e++){this.content[e].Draw(t)}}},{key:"ParseFromXml",value:function(t){if(null!=t._ID&&(this.id=t._ID.toString()),null!=t._BaseLoc&&(this.baseLoc=t._BaseLoc.toString(),null!=this.docs&&(t=this.docs.get(this.baseLoc).Page)),null!=t.Area&&this.area.ParseFromXml(t.Area),null!=t.Content&&Array.isArray(t.Content))for(var e=0;e<ofd.DocBody.length;e++){var i=t.Content[e],s=new S(this.commonData);s.ParseFromXml(i),this.content.push(s)}else if(null!=t.Content){var n=new S(this.commonData);n.ParseFromXml(t.Content),this.content.push(n)}if(null!=t.Template&&Array.isArray(t.Template))for(e=0;e<ofd.Template.length;e++){i=t.Template[e];var a=new F(this.commonData);a.ParseFromXml(i),this.template.push(a)}else if(null!=t.Template){var r=new F(this.commonData);r.ParseFromXml(t.Template),this.template.push(r)}}}]),e}(),x=function(){function e(i,s){t(this,e),this.docs=i,this.commonData=s,this.id="",this.page=new M(this.docs,this.commonData),this.baseLoc="",this.name="",this.zOrder=""}return i(e,[{key:"Draw",value:function(t){this.page.Draw(t)}},{key:"ParseFromXml",value:function(t){if(null!=t._ID&&(this.id=t._ID.toString()),null!=t._BaseLoc){this.baseLoc=t._BaseLoc.toString();var e=this.docs.get(this.baseLoc);this.page.ParseFromXml(e.Page)}null!=t._Name&&(this.name=t._Name.toString()),null!=t._ZOrder&&(this.zOrder=t._ZOrder.toString())}}]),e}(),k=function(){function e(){t(this,e),this.id="",this.relative="",this.lineWidth=.353,this.cap="Butt",this.dashOffset=0,this.dashPattern=[],this.join="Miter",this.miterLimit=3.528,this.fillColor=new d,this.strokeColor=new d}return i(e,[{key:"SetCtx",value:function(t){t.miterLimit=this.MM2PX(this.miterLimit),t.lineWidth=this.MM2PX(this.lineWidth),t.strokeStyle=this.strokeColor.GetCtxDrawColor(),t.fillStyle=this.fillColor.GetCtxDrawColor(),t.lineCap=this.cap.toLowerCase()}},{key:"ParseFromXml",value:function(t){if(null!=t._ID&&(this.id=t._ID.toString()),null!=t._Relative&&(this.relative=t._Relative.toString()),null!=t._LineWidth&&(this.lineWidth=parseFloat(t._LineWidth.toString())),null!=t._Cap&&(this.cap=t._Cap.toString()),null!=t._DashOffset&&(this.dashOffset=parseFloat(t._DashOffset.toString())),null!=t.DashPattern)for(var e=t.DashPattern.split(" "),i=0;i<e.length;i++)this.dashPattern.push(parseInt(e[i]));null!=t._Join&&(this.join=t._Join.toString()),null!=t._MiterLimit&&(this.miterLimit=parseFloat(t._MiterLimit.toString())),null!=t.FillColor&&this.fillColor.ParseFromXml(t.FillColor),null!=t.StrokeColor&&this.strokeColor.ParseFromXml(t.StrokeColor)}},{key:"MM2PX",value:function(t){return parseFloat(parseFloat(t)/25.4*96)}}]),e}(),C=function(){function e(){t(this,e),this.fontname="",this.familyName="",this.charset="unicode",this.italic=!1,this.bold=!1,this.serif=!1,this.fixedWidth=!1,this.fontFile=""}return i(e,[{key:"ParseFromXml",value:function(t){null!=t._ID&&(this.id=t._ID.toString()),null!=t._FontName&&(this.fontname=t._FontName.toString()),null!=t._FamilyName&&(this.familyName=t._FamilyName.toString()),null!=t._Charset&&(this.charset=t._Charset.toString()),null!=t._Italic&&(this.italic=!0),null!=t._Bold&&(this.bold=!0),null!=t._Serif&&(this.serif=!0),null!=t._FixedWidth&&(this.fixedWidth=!0),null!=t._FontFile&&(this.fontFile=t._FontFile.toString())}}]),e}(),I=function(){function e(i){t(this,e),this.docs=i,this.id="",this.type="",this.format="",this.mediaFile="",this.image=null}return i(e,[{key:"ParseFromXml",value:function(t){this.id=t._ID.toString(),null!=t._Type&&(this.type=t._Type.toString()),null!=t._Format&&(this.format=t._Format),null!=t.MediaFile&&(this.mediaFile=t.MediaFile.toString(),0==this.mediaFile.indexOf("Res/")?this.image=this.docs.get(this.mediaFile):this.image=this.docs.get("Res/"+this.mediaFile))}}]),e}(),X=function(){function e(i){t(this,e),this.docs=i,this.baseLoc="",this.colorSpaces=[],this.drawParams=[],this.fonts=[],this.multiMedias=[],this.compositeGraphicUnits=[]}return i(e,[{key:"GetDrawParamByID",value:function(t){for(var e=0;e<this.drawParams.length;e++){var i=this.drawParams[e];if(i.id==t)return i}return null}},{key:"GetFontByID",value:function(t){for(var e=0;e<this.fonts.length;e++){var i=this.fonts[e];if(i.id==t)return i}return null}},{key:"GetMultiMediasByID",value:function(t){for(var e=0;e<this.multiMedias.length;e++){var i=this.multiMedias[e];if(i.id==t)return i}return null}},{key:"ParseFromXml",value:function(t){if(null!=t.toString()){var e=this.docs.get(t.toString()).Res;if(null!=e._BaseLoc&&(this.baseLoc=e._BaseLoc.toString()),null!=e.DrawParams)if(null!=e.DrawParams.DrawParam&&Array.isArray(e.DrawParams.DrawParam))for(var i=0;i<e.DrawParams.DrawParam.length;i++){var s=e.DrawParams.DrawParam[i],n=new k;n.ParseFromXml(s),this.drawParams.push(n)}else if(null!=e.DrawParams){var a=new k;a.ParseFromXml(e.DrawParams),this.drawParams.push(a)}if(null!=e.Fonts)if(null!=e.Fonts.Font&&Array.isArray(e.Fonts.Font))for(i=0;i<e.Fonts.Font.length;i++){s=e.Fonts.Font[i];var r=new C;r.ParseFromXml(s),this.fonts.push(r)}else if(null!=e.Fonts){var o=new C;o.ParseFromXml(e.Fonts.Font),this.fonts.push(o)}if(null!=e.MultiMedias)if(null!=e.MultiMedias.MultiMedia&&Array.isArray(e.MultiMedias.MultiMedia))for(i=0;i<e.MultiMedias.MultiMedia.length;i++){s=e.MultiMedias.MultiMedia[i];var l=new I(this.docs);l.ParseFromXml(s),this.multiMedias.push(l)}else if(null!=e.MultiMedias){var h=new I(this.docs);h.ParseFromXml(e.MultiMedias.MultiMedia),this.multiMedias.push(h)}}}},{key:"ParseFromXmlOFD",value:function(t){if(null!=t.toString()){if(null!=t._BaseLoc&&(this.baseLoc=t._BaseLoc.toString()),null!=t.DrawParams)if(null!=t.DrawParams.DrawParam&&Array.isArray(t.DrawParams.DrawParam))for(var e=0;e<t.DrawParams.DrawParam.length;e++){var i=t.DrawParams.DrawParam[e],s=new k;s.ParseFromXml(i),this.drawParams.push(s)}else if(null!=t.DrawParams){var n=new k;n.ParseFromXml(t.DrawParams),this.drawParams.push(n)}if(null!=t.Fonts)if(null!=t.Fonts.Font&&Array.isArray(t.Fonts.Font))for(e=0;e<t.Fonts.Font.length;e++){i=t.Fonts.Font[e];var a=new C;a.ParseFromXml(i),this.fonts.push(a)}else if(null!=t.Fonts){var r=new C;r.ParseFromXml(t.Fonts.Font),this.fonts.push(r)}if(null!=t.MultiMedias)if(null!=t.MultiMedias.MultiMedia&&Array.isArray(t.MultiMedias.MultiMedia))for(e=0;e<t.MultiMedias.MultiMedia.length;e++){i=t.MultiMedias.MultiMedia[e];var o=new I(this.docs);o.ParseFromXml(i),this.multiMedias.push(o)}else if(null!=t.MultiMedias){var l=new I(this.docs);l.ParseFromXml(t.MultiMedias.MultiMedia),this.multiMedias.push(l)}}}}]),e}(),_=function(){function e(i){t(this,e),this.docs=i,this.maxUnitID="",this.pageArea=new f,this.publicRes="",this.pubres=[],this.documentRes="",this.docres=[],this.templatePage=[],this.defaultCS=""}return i(e,[{key:"GetTemplatePageByID",value:function(t){for(var e=0;e<this.templatePage.length;e++){var i=this.templatePage[e];if(i.id==t)return i}return null}},{key:"GetPublicRes",value:function(){return this.pubres.length>0?this.pubres:null}},{key:"GetMultiMediasByID",value:function(t){if(this.pubres.length>0)for(var e=0;e<this.pubres.length;e++){var i=this.pubres[e].GetMultiMediasByID(t);if(null!=i)return i}if(this.docres.length>0)for(e=0;e<this.docres.length;e++){var s=this.docres[e].GetMultiMediasByID(t);if(null!=s)return s}return null}},{key:"GetFontByID",value:function(t){for(var e=0;e<this.templatePage.length;e++){var i=this.templatePage[e];if(i.id==t)return i}return null}},{key:"ParseFromXml",value:function(t){if(null!=t.MaxUnitID&&(this.maxUnitID=t.MaxUnitID.toString()),null!=t.DefaultCS&&(this.defaultCS=t.DefaultCS.toString()),null!=t.PageArea&&this.pageArea.ParseFromXml(t.PageArea),null!=t.TemplatePage&&Array.isArray(t.TemplatePage))for(var e=0;e<t.TemplatePage.length;e++){var i=t.TemplatePage[e],s=new x(this.docs,this);s.ParseFromXml(i),this.templatePage.push(s)}else if(null!=t.TemplatePage){var n=new x(this.docs,this);n.ParseFromXml(t.TemplatePage),this.templatePage.push(n)}if(null!=t.PublicRes&&Array.isArray(t.PublicRes)){this.publicRes=t.PublicRes.toString();for(e=0;e<t.PublicRes.length;e++){i=t.TemplatePage[e];var a=new X(this.docs);a.ParseFromXml(i),this.pubres.push(a)}}else if(null!=t.PublicRes){this.publicRes=t.PublicRes.toString();var r=new X(this.docs);r.ParseFromXml(t.PublicRes),this.pubres.push(r)}if(null!=t.DocumentRes&&Array.isArray(t.DocumentRes)){this.documentRes=t.DocumentRes.toString();for(e=0;e<t.DocumentRes.length;e++){i=t.TemplatePage[e];var o=new X(this.docs);o.ParseFromXml(i),this.docres.push(o)}}else if(null!=t.DocumentRes){this.documentRes=t.DocumentRes.toString();var l=new X(this.docs);l.ParseFromXml(t.DocumentRes),this.docres.push(l)}}}]),e}(),T=function(){function e(i,s){t(this,e),this.docs=i,this.commonData=s,this.page=[]}return i(e,[{key:"ParseFromXml",value:function(t){if(null!=t.Page&&Array.isArray(t.Page))for(var e=0;e<t.Page.length;e++){var i=t.Page[e],s=new M(this.docs,this.commonData);s.ParseFromXml(i),this.page.push(s)}else if(null!=t.Page){var n=new M(this.docs,this.commonData);n.ParseFromXml(t.Page),this.page.push(n)}}}]),e}(),B=function(){function e(i){t(this,e),this.docs=i.docs[0],this.commonData=new _(this.docs),this.pages=new T(this.docs,this.commonData),this.bookmarks=[],this.annotations="Annots/Annotations.xml",this.attachments="Attachs/Attachments.xml",this.rootPath=""}return i(e,[{key:"ParseFromXml",value:function(t){if(null!=this.docs){var e=this.docs.get("Document.xml").Document;null!=e.CommonData&&this.commonData.ParseFromXml(e.CommonData),null!=e.Pages&&this.pages.ParseFromXml(e.Pages)}}}]),e}(),O=function(){function e(){t(this,e),this.providerName="",this.company="",this.version=""}return i(e,[{key:"ParseFromXml",value:function(t){null!=t._ProviderName&&(this.providerName=t._ProviderName.toString()),null!=t._Company&&(this.company=t._Company.toString()),null!=t._Version&&(this.version=t._Version.toString())}}]),e}(),N=function(){function e(){t(this,e),this.fileRef="",this.checkValue=""}return i(e,[{key:"ParseFromXml",value:function(t){null!=t._FileRef&&(this.fileRef=t._FileRef.toString()),null!=t.CheckValue&&(this.checkValue=t.CheckValue.toString())}}]),e}(),A=function(){function e(i){t(this,e),this.docs=i,this.checkMethod="MD5",this.reference=[]}return i(e,[{key:"ParseFromXml",value:function(t){if(null!=t._CheckMethod&&(this.checkMethod=t._CheckMethod.toString()),null!=t.Reference)if(null!=t.Reference&&Array.isArray(t.Reference))for(var e=0;e<t.Reference.length;e++){var i=t.Reference[e],s=new N(this.docs);s.ParseFromXml(i),this.reference.push(s)}else if(null!=t.StampAnnot){var n=new N(this.docs);n.ParseFromXml(t.StampAnnot),this.reference.push(n)}}}]),e}(),R=function(){function e(){t(this,e),this.pageRef="",this.id="",this.boundary=null}return i(e,[{key:"ParseFromXml",value:function(t){null!=t._PageRef&&(this.pageRef=t._PageRef.toString()),null!=t._ID&&(this.id=t._ID.toString()),null!=t._Boundary&&(this.boundary=this.Parse(t._Boundary))}},{key:"Parse",value:function(t){try{var e=t.split(" ");return{x:parseFloat(e[0]),y:parseFloat(e[1]),w:parseFloat(e[2]),h:parseFloat(e[3])}}catch(t){return{x:0,y:0,w:0,h:0}}}}]),e}(),E=function(){function e(){t(this,e),this.ocxNumber=0,this.hexNumber=0,this.offset=0,this.lenth=0,this.value=null}return i(e,[{key:"Parse",value:function(t){var e=t[0];if(this.offset++,e!=this.ocxNumber)throw new Error("非法的"+this.elementType+"对应");var i=t[1];this.offset++;var s=0;if(i<128)s=i;else{var n=i-128;s=this.BitToInt(t.slice(this.offset,this.offset+n)),this.offset=this.offset+n}this.lenth=s}},{key:"value",value:function(){return this.value}},{key:"BitToInt",value:function(t){return 1==t.length?t[0]:2==t.length?t[0]<<8|t[1]:3==t.length?t[0]<<16|t[1]<<8|t[2]:4==t.length?t[0]<<32|t[1]<<16|t[2]<<8|t[3]:5==t.length?t[0]<<64|t[2]<<32|t[3]<<16|t[4]<<8|t[5]:void 0}}]),e}(),j=function(e){n(r,e);var s=l(r);function r(){var e;return t(this,r),(e=s.call(this)).elementType="IA5String",e.ocxNumber=22,e.hexNumber=22,e.value="",e}return i(r,[{key:"Parse",value:function(t){h(a(r.prototype),"Parse",this).call(this,t);var e=t.slice(this.offset,this.offset+this.lenth);this.value=String.fromCharCode.apply(null,e)}}]),r}(E),z=function(e){n(r,e);var s=l(r);function r(){var e;return t(this,r),(e=s.call(this)).elementType="INTEGER",e.ocxNumber=2,e.hexNumber=2,e.value="",e}return i(r,[{key:"Parse",value:function(t){h(a(r.prototype),"Parse",this).call(this,t),this.value=this.BitToInt(t.slice(this.offset,this.offset+this.lenth))}}]),r}(E),L=function(e){n(r,e);var s=l(r);function r(){var e;return t(this,r),(e=s.call(this)).elementType="SEQUENCE",e.ocxNumber=48,e.hexNumber=48,e.ID=new j("ES"),e.version=new z(4),e.Vid=new j,e}return i(r,[{key:"Parse",value:function(t){h(a(r.prototype),"Parse",this).call(this,t),this.ID.Parse(t.slice(this.offset));var e=this.offset+this.ID.offset+this.ID.lenth;this.version.Parse(t.slice(e)),e=this.offset+this.version.offset+this.version.lenth,this.Vid.Parse(t.slice(e))}}]),r}(E),G=function(e){n(r,e);var s=l(r);function r(){var e;return t(this,r),(e=s.call(this)).elementType="SEQUENCE",e.ocxNumber=48,e.hexNumber=48,e}return i(r,[{key:"Parse",value:function(t){h(a(r.prototype),"Parse",this).call(this,t)}}]),r}(E),V=function(e){n(r,e);var s=l(r);function r(){var e;return t(this,r),(e=s.call(this)).elementType="OCTET STRING",e.ocxNumber=4,e.hexNumber=4,e}return i(r,[{key:"Parse",value:function(t){h(a(r.prototype),"Parse",this).call(this,t),this.value=t.slice(this.offset,this.offset+this.lenth)}}]),r}(E),W=function(e){n(r,e);var s=l(r);function r(){var e;return t(this,r),(e=s.call(this)).elementType="SEQUENCE",e.ocxNumber=48,e.hexNumber=48,e.type=new j,e.data=new V,e.width=new z,e.height=new z,e}return i(r,[{key:"Parse",value:function(t){h(a(r.prototype),"Parse",this).call(this,t),this.type.Parse(t.slice(this.offset));var e=this.offset+this.type.offset+this.type.lenth;this.data.Parse(t.slice(e)),e=e+this.data.offset+this.data.lenth,this.width.Parse(t.slice(e)),e=e+this.width.offset+this.width.lenth,this.height.Parse(t.slice(e))}}]),r}(E),Y=function(e){n(r,e);var s=l(r);function r(){var e;return t(this,r),(e=s.call(this)).elementType="SEQUENCE",e.ocxNumber=48,e.hexNumber=48,e.header=new L,e.esID=new j,e.property=new G,e.picture=new W,e}return i(r,[{key:"Parse",value:function(t){h(a(r.prototype),"Parse",this).call(this,t),this.header.Parse(t.slice(this.offset));var e=this.offset+this.header.offset+this.header.lenth;this.esID.Parse(t.slice(e)),e=e+this.esID.offset+this.esID.lenth,this.property.Parse(t.slice(e)),e=e+this.property.offset+this.property.lenth,this.picture.Parse(t.slice(e))}}]),r}(E),U=function(e){n(r,e);var s=l(r);function r(){var e;return t(this,r),(e=s.call(this)).elementType="SEQUENCE",e.ocxNumber=48,e.hexNumber=48,e}return i(r,[{key:"Parse",value:function(t){h(a(r.prototype),"Parse",this).call(this,t)}}]),r}(E),Z=function(e){n(r,e);var s=l(r);function r(){var e;return t(this,r),(e=s.call(this)).version="2014",e.ocxNumber=48,e.hexNumber=48,e.eSealInof=new Y,e.signInfo=new U,e}return i(r,[{key:"Parse",value:function(t){h(a(r.prototype),"Parse",this).call(this,t),this.eSealInof.Parse(t.slice(this.offset));var e=this.offset+this.eSealInof.offset+this.eSealInof.lenth;this.signInfo.Parse(t.slice(e))}}]),r}(E),H=function(e){n(r,e);var s=l(r);function r(){var e;return t(this,r),(e=s.call(this)).elementType="SEQUENCE",e.ocxNumber=48,e.hexNumber=48,e.ID=new j("ES"),e.version=new z(4),e.Vid=new j,e}return i(r,[{key:"Parse",value:function(t){h(a(r.prototype),"Parse",this).call(this,t),this.ID.Parse(t.slice(this.offset));var e=this.offset+this.ID.offset+this.ID.lenth;this.version.Parse(t.slice(e)),e=e+this.version.offset+this.version.lenth,this.Vid.Parse(t.slice(e))}}]),r}(E),J=function(e){n(a,e);var s=l(a);function a(){var e;return t(this,a),(e=s.call(this)).elementType="GeneralizedTime",e.ocxNumber=24,e.hexNumber=24,e}return i(a,[{key:"Parse",value:function(t){}}]),a}(E),Q=function(e){n(r,e);var s=l(r);function r(){var e;return t(this,r),(e=s.call(this)).elementType="SEQUENCE",e.ocxNumber=48,e.hexNumber=48,e.type=new z,e}return i(r,[{key:"Parse",value:function(t){h(a(r.prototype),"Parse",this).call(this,t)}}]),r}(E),$=function(e){n(r,e);var s=l(r);function r(){var e;return t(this,r),(e=s.call(this)).elementType="SEQUENCE",e.ocxNumber=48,e.hexNumber=48,e.type=new j,e.data=new V,e.width=new z,e.height=new z,e}return i(r,[{key:"Parse",value:function(t){h(a(r.prototype),"Parse",this).call(this,t),this.type.Parse(t.slice(this.offset));var e=this.offset+this.type.offset+this.type.lenth;this.data.Parse(t.slice(e)),e=e+this.data.offset+this.data.lenth,this.width.Parse(t.slice(e)),e=e+this.width.offset+this.width.lenth,this.height.Parse(t.slice(e))}}]),r}(E),q=function(e){n(r,e);var s=l(r);function r(){var e;return t(this,r),(e=s.call(this)).elementType="SEQUENCE",e.ocxNumber=48,e.hexNumber=48,e.header=new H,e.esID=new j,e.property=new Q,e.picture=new $,e}return i(r,[{key:"Parse",value:function(t){h(a(r.prototype),"Parse",this).call(this,t),this.header.Parse(t.slice(this.offset));var e=this.offset+this.header.offset+this.header.lenth;this.esID.Parse(t.slice(e)),e=e+this.esID.offset+this.esID.lenth,this.property.Parse(t.slice(e)),e=e+this.property.offset+this.property.lenth,this.picture.Parse(t.slice(e))}}]),r}(E),K=function(e){n(r,e);var s=l(r);function r(){var e;return t(this,r),(e=s.call(this)).elementType="IDENTIFIER",e.ocxNumber=6,e.hexNumber=6,e}return i(r,[{key:"Parse",value:function(t){h(a(r.prototype),"Parse",this).call(this,t)}}]),r}(E),tt=function(e){n(r,e);var s=l(r);function r(){var e;return t(this,r),(e=s.call(this)).elementType="BITSTRING",e.ocxNumber=3,e.hexNumber=3,e}return i(r,[{key:"Parse",value:function(t){h(a(r.prototype),"Parse",this).call(this,t)}}]),r}(E),et=function(e){n(r,e);var s=l(r);function r(){var e;return t(this,r),(e=s.call(this)).version="2020",e.ocxNumber=48,e.hexNumber=48,e.eSealInof=new q,e.cert=new V,e.signAlgID=new K,e.signValue=new tt,e}return i(r,[{key:"Parse",value:function(t){h(a(r.prototype),"Parse",this).call(this,t),this.eSealInof.Parse(t.slice(this.offset));var e=this.offset+this.eSealInof.offset+this.eSealInof.lenth;this.cert.Parse(t.slice(e)),e=e+this.cert.offset+this.cert.lenth,this.signAlgID.Parse(t.slice(e)),e=e+this.signAlgID.offset+this.signAlgID.lenth,this.signValue.Parse(t.slice(e))}}]),r}(E),it=function(){function e(){t(this,e),this.seal=null,this.version="2014"}return i(e,[{key:"Parse",value:function(t){this.seal=null;try{this.seal=new Z,this.seal.Parse(t)}catch(e){try{this.version="2020",this.seal=new et,this.seal.Parse(t)}catch(t){}}}},{key:"GetDrawData",value:function(){var t=this.seal.eSealInof.picture.data.value,e=this.seal.eSealInof.picture.type.value;return new Promise((function(i,s){"ofd"==e&&(e="png");var n=new Blob([t],{type:"image/"+e}),a=URL.createObjectURL(n),r=document.createElement("img");r.src=a,r.onload=function(){i(r)},r.onerror=function(){s(new Error("Failed to load image"))}}))}}]),e}(),st=function(){function e(i){t(this,e),this.singedInfo=i}return i(e,[{key:"Draw",value:function(t,e){try{var i=this.readImage(),s=new _(null);i.then((function(e){t.save(),s.pubres.push(e.res);for(var i=e.singedInfo.stampAnnot[0].boundary,n=e.page.content[0].layers[0],a=0;a<n.pathObject.length;a++){var r=n.pathObject[a];r.boundary.x=r.boundary.x+i.x,r.boundary.y=r.boundary.y+i.y,r.Draw(t)}for(a=0;a<n.textObject.length;a++){var o=n.textObject[a];o.boundary.x=o.boundary.x+i.x,o.boundary.y=o.boundary.y+i.y,o.commonData=s,o.Draw(t)}t.restore()}))}catch(t){throw new Error("ofd 绘制签章内容出错")}}},{key:"readImage",value:function(){var t=this,e=this;return new Promise((function(i,s){var n=t.singedInfo.signature.signature.signature.toSign.eseal.eSealInof.picture.data.value,a=new Blob([n]),r=new JSZip,o=new X2JS({stripWhitespaces:!1,skipEmptyTextNodesForObj:!1});r.loadAsync(a).then((function(t){var s=Object.keys(t.files),n=[];s.forEach((function(i){var s=null;(i.includes("Res")||i.includes("Page"))&&(s=t.file(i).async("string"),n.push(s)),null!=s&&s.then((function(t){if(i.includes("Res")){var s=o.xml2js(t);e.res=new X,e.res.ParseFromXmlOFD(s.Res)}else if(i.includes("Page")){var n=o.xml2js(t);e.page=new M,e.page.ParseFromXml(n.Page)}}))})),Promise.all(n).then((function(){i(e)}))}))}))}}]),e}(),nt=function(){function e(i,s){t(this,e),this.docs=i,this.signature=s,this.provider=new O(i),this.ofdImage=new st(this),this.signatureMethod="",this.signatureDateTime="",this.references=new A(i),this.stampAnnot=[],this.sealLoc=null}return i(e,[{key:"ParseFromXml",value:function(t,e){if(null!=t.Provider&&this.provider.ParseFromXml(t.Provider),null!=t.SignatureMethod&&(this.signatureMethod=t.SignatureMethod.toString()),null!=t.SignatureDateTime&&(this.signatureDateTime=t.SignatureDateTime.toString()),null!=t.References&&this.references.ParseFromXml(t.References),null!=t.StampAnnot)if(null!=t.StampAnnot&&Array.isArray(t.StampAnnot))for(var i=0;i<t.StampAnnot.length;i++){var s=t.StampAnnot[i],n=new R(this.docs);n.ParseFromXml(s),this.stampAnnot.push(n)}else if(null!=t.StampAnnot){var a=new R(this.docs);a.ParseFromXml(t.StampAnnot),this.stampAnnot.push(a)}null!=t.Seal&&(this.sealLoc=t.Seal.BaseLoc.toString(),this.sealdate=this.docs.get("Signs/"+e.replace("Signature.xml",this.sealLoc)),this.seal=new it,this.seal.Parse(this.sealdate))}},{key:"Draw",value:function(t,e){try{var i=this.GetPageBox(e);if(null==i)return;var s=this.ToPX(i.x),n=this.ToPX(i.y),a=this.ToPX(i.w),r=this.ToPX(i.h);if(null!=this.signature.signature)if("ofd"==this.signature.signature.signature.toSign.eseal.eSealInof.picture.type.value)this.ofdImage.Draw(t,e);else this.signature.signature.GetDrawData().then((function(e){t.save(),t.drawImage(e,s,n,a,r),t.restore()}));else if(null!=this.seal){this.seal.GetDrawData().then((function(e){t.save(),t.drawImage(e,s,n,a,r),t.restore()}))}}catch(t){}}},{key:"GetPageBox",value:function(t){for(var e=0;e<this.stampAnnot.length;e++){var i=this.stampAnnot[e];if(i.pageRef==t)return i.boundary}if(this.stampAnnot.length>0)return this.stampAnnot[0].boundary}},{key:"ToPX",value:function(t){return parseFloat(parseFloat(t)/25.4*96)}}]),e}(),at=function(e){n(r,e);var s=l(r);function r(){var e;return t(this,r),(e=s.call(this)).ocxNumber=48,e.hexNumber=48,e.version=new z,e.eseal=new Z,e.timeInfo=new tt,e.dadaHash=new tt,e.propertyInfo=new j,e.cert=new V,e.signatureAlgorthm=new K,e}return i(r,[{key:"Parse",value:function(t){h(a(r.prototype),"Parse",this).call(this,t),this.version.Parse(t.slice(this.offset));var e=this.offset+this.version.offset+this.version.lenth;this.eseal.Parse(t.slice(e)),e=this.offset+this.eseal.offset+this.eseal.lenth,this.timeInfo.Parse(t.slice(e)),e=this.offset+this.timeInfo.offset+this.timeInfo.lenth,this.dadaHash.Parse(t.slice(e)),e=this.offset+this.dadaHash.offset+this.dadaHash.lenth,this.propertyInfo.Parse(t.slice(e)),e=this.offset+this.propertyInfo.offset+this.propertyInfo.lenth,this.cert.Parse(t.slice(e)),e=this.offset+this.cert.offset+this.cert.lenth,this.signatureAlgorthm.Parse(t.slice(e))}},{key:"GetDrawData",value:function(){}}]),r}(E),rt=function(e){n(r,e);var s=l(r);function r(){var e;return t(this,r),(e=s.call(this)).version="2014",e.ocxNumber=48,e.hexNumber=48,e.toSign=new at,e.Signature=new tt,e}return i(r,[{key:"Parse",value:function(t){h(a(r.prototype),"Parse",this).call(this,t),this.toSign.Parse(t.slice(this.offset));var e=this.offset+this.toSign.offset+this.toSign.lenth;this.Signature.Parse(t.slice(e))}},{key:"GetDrawData",value:function(){}}]),r}(E),ot=function(e){n(r,e);var s=l(r);function r(){var e;return t(this,r),(e=s.call(this)).ocxNumber=48,e.hexNumber=48,e.version=new z,e.eseal=new et,e.timeInfo=new J,e.dadaHash=new tt,e.propertyInfo=new j,e}return i(r,[{key:"Parse",value:function(t){h(a(r.prototype),"Parse",this).call(this,t),this.version.Parse(t.slice(this.offset));var e=this.offset+this.version.offset+this.version.lenth;this.eseal.Parse(t.slice(e)),e=this.offset+this.eseal.offset+this.eseal.lenth,this.timeInfo.Parse(t.slice(e)),e=this.offset+this.timeInfo.offset+this.timeInfo.lenth,this.dadaHash.Parse(t.slice(e)),e=this.offset+this.dadaHash.offset+this.dadaHash.lenth,this.propertyInfo.Parse(t.slice(e))}},{key:"GetDrawData",value:function(){}}]),r}(E),lt=function(e){n(r,e);var s=l(r);function r(){var e;return t(this,r),(e=s.call(this)).version="2020",e.ocxNumber=48,e.hexNumber=48,e.toSign=new ot,e.cert=new V,e.signatureAlID=new K,e.signature=new tt,e}return i(r,[{key:"Parse",value:function(t){h(a(r.prototype),"Parse",this).call(this,t),this.toSign.Parse(t.slice(this.offset));var e=this.offset+this.toSign.offset+this.toSign.lenth;this.Signature.Parse(t.slice(e)),e=this.offset+this.Signature.offset+this.Signature.lenth,this.cert.Parse(t.slice(e)),e=this.offset+this.cert.offset+this.cert.lenth,this.signatureAlID.Parse(t.slice(e)),e=this.offset+this.signatureAlID.offset+this.signatureAlID.lenth,this.signature.Parse(t.slice(e))}},{key:"GetDrawData",value:function(){}}]),r}(E),ht=function(){function e(){t(this,e),this.version="2014"}return i(e,[{key:"Parse",value:function(t){this.signature=null;try{this.signature=new rt,this.signature.Parse(t)}catch(e){try{this.version="2020",this.signature=new lt,this.signature.Parse(t)}catch(t){}}}},{key:"GetDrawData",value:function(){return this.signature.toSign.eseal.eSealInof.picture.data.value,this.signature.toSign.eseal.eSealInof.picture.type.value,new Promise((function(t,e){var i=URL.createObjectURL(blob),s=document.createElement("img");s.src=i,s.onload=function(){t(s)},s.onerror=function(t){e(new Error("Failed to load image"))}}))}}]),e}(),ut=function(){function e(i){t(this,e),this.docs=i,this.id="",this.type="",this.baseLoc="",this.singedInfo=new nt(this.docs,this),this.signedValue=""}return i(e,[{key:"ParseFromXml",value:function(t){if(null!=t._ID&&(this.id=t._ID.toString()),null!=t._Type&&(this.type=t._Type.toString()),null!=t._BaseLoc){this.baseLoc=t._BaseLoc.toString(),this.baseLoc.includes("Doc")&&(this.baseLoc=this.baseLoc.replace("/Doc_0/","")),this.baseLoc.includes("Signs/")||(this.baseLoc="Signs/"+this.baseLoc);var e=this.docs.get(this.baseLoc).Signature;null!=e.SignedValue&&(this.signedValue=e.SignedValue.toString(),this.signedValue.includes("Doc")&&(this.signedValue=this.signedValue.replace("/Doc_0/",""),this.signedValue=this.signedValue.replace("Doc_0/","")),this.signedValue.includes("Signs/")?this.signedate=this.docs.get(this.signedValue):this.signedate=this.docs.get(this.baseLoc.replace("Signature.xml",this.signedValue)),this.signature=new ht,this.signature.Parse(this.signedate)),null!=e.SignedInfo&&this.singedInfo.ParseFromXml(e.SignedInfo,this.baseLoc)}}},{key:"Draw",value:function(t,e){this.singedInfo.Draw(t,e)}}]),e}(),ct=function(){function e(i){t(this,e),this.docs=i.docs[0],this.maxSignId="",this.signature=[]}return i(e,[{key:"ParseFromXml",value:function(t){var e="";t.concat("Doc")&&(e=t.replace("Doc_0/",""));var i=this.docs.get(e).Signatures;if(null!=i.MaxSignId&&(this.maxSignId=i.MaxSignId.toString()),null!=i.Signature)if(null!=i.Signature&&Array.isArray(i.Signature))for(var s=0;s<i.Signature.length;s++){var n=i.Signature[s],a=new ut(this.docs);a.ParseFromXml(n),this.signature.push(a)}else if(null!=i.Signature){var r=new ut(this.docs);r.ParseFromXml(i.Signature),this.signature.push(r)}}},{key:"Draw",value:function(t,e){for(var i=0;i<this.signature.length;i++){this.signature[i].Draw(t,e);break}}}]),e}(),ft=function(){function e(i){t(this,e),this.docInfo=new c,this.docRoot=new B(i),this.docRootLoc="",this.signatures=new ct(i),this.signaturesLoc=""}return i(e,[{key:"ParseFromXml",value:function(t){null!=t.DocInfo&&this.docInfo.ParseFromXml(t.DocInfo),null!=t.DocRoot&&(this.docRootLoc=t.DocRoot.toString().replace("/Doc_","Doc_")),null!=t.Signatures&&(this.signaturesLoc=t.Signatures.toString().replace("/Doc_","Doc_"),this.signatures.ParseFromXml(this.signaturesLoc)),this.docRoot.ParseFromXml(t)}}]),e}(),mt=function(){function e(){t(this,e),this.version="1.1",this.docType="OFD",this.docBody=[],this.xmlns__ofd="http://www.ofdspec.org/2016"}return i(e,[{key:"ParseFromXml",value:function(t){if(this.docBody=[],null!=t.ofd.OFD){var e=t.ofd.OFD;if(null!=e.DocBody&&Array.isArray(e.DocBody))for(var i=0;i<e.DocBody.length;i++){var s=e.DocBody[i],n=new ft(t);n.ParseFromXml(s),this.docBody.push(n)}else if(null!=e.DocBody){var a=new ft(t);a.ParseFromXml(e.DocBody),this.docBody.push(a)}}}}]),e}(),dt=function(){function e(){t(this,e),this.x2js=new X2JS({stripWhitespaces:!1,skipEmptyTextNodesForObj:!1}),this.zip=new JSZip}return i(e,[{key:"SetBlob",value:function(t){this.blob=t}},{key:"readImage",value:function(t,e){return e.endsWith(".jb2")?new Promise((function(i,s){t.file(e).async("blob").then((function(t){var e=new FileReader;e.onload=function(t){var e=t.target.result,n=new Uint8Array(e),a=new Jbig2Image,r=a.parse(n),o=document.createElement("canvas");o.width=a.width,o.height=a.height;for(var l=o.getContext("2d"),h=l.getImageData(0,0,o.width,o.height),u=h.data,c=0,f=0;c<u.length;c+=4,f++){255==r[f]?(u[c]=255,u[c+1]=255,u[c+2]=255):(u[c]=0,u[c+1]=0,u[c+2]=0),u[c+3]=255}l.putImageData(h,0,0);var m=o.toDataURL("image/png"),d=new Image;d.onload=function(){i(d)},d.onerror=function(t){s(new Error("Failed to load image"))},d.src=m},e.readAsArrayBuffer(t)}))})):new Promise((function(i,s){t.file(e).async("blob").then((function(t){var n=new Image;e.includes(".bmp")&&(n.alt="BMP Image"),n.onload=function(){i(n)},n.onerror=function(){s(new Error("Failed to load image"))},n.src=URL.createObjectURL(t)}))}))}},{key:"readBlobAsByteArray",value:function(t,e){var i=new FileReader;return new Promise((function(s,n){t.file(e).async("blob").then((function(t){i.onloadend=function(t){if(t.target.readyState===FileReader.DONE){var e=t.target.result,i=new Uint8Array(e);s(i)}},i.onerror=function(t){n(new Error("读取 Blob 错误"))},i.readAsArrayBuffer(t)}))}))}},{key:"readFile",value:function(){var t=this,e={docs:[]};return new Promise((function(i,s){try{var n=t;t.zip.loadAsync(t.blob).then((function(s){var a=[],r=s.file("OFD.xml").async("string");a.push(r),r.then((function(t){e.ofd=n.x2js.xml2js(t)}));var o=new Map;e.docs.push(o);var l=/^Doc_0\/.*\.xml$/,h=/^Doc_0\/Res\/.*\.(jpg|jpeg|png|gif|bmp|jb2)$/i;s.folder("Doc_0").forEach((function(e,i){if(l.test(i.name)){var r=s.file(i.name).async("string");a.push(r),r.then((function(t){o.set(e,n.x2js.xml2js(t))}))}if(h.test(i.name)){var u=t.readImage(s,i.name);a.push(u),u.then((function(t){o.set(e,t)}))}if(e.startsWith("Signs/")&&e.endsWith(".esl")|e.endsWith(".dat")){var c=t.readBlobAsByteArray(s,i.name);a.push(c),c.then((function(t){o.set(e,t)}))}})),Promise.all(a).then((function(){i(e)}))}))}catch(t){s("读取文件错误！--"+t)}}))}}]),e}(),pt=function(){function e(){var i=this;t(this,e),s(this,"$on",(function(t,e){i.event[t]?-1==i.event[t].indexOf(e)&&i.event[t].push(e):(i.event[t]=[],i.event[t].push(e))})),s(this,"$emit",(function(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),n=1;n<e;n++)s[n-1]=arguments[n];if(i.event[t])try{i.event[t].map((function(t){t.apply(void 0,s)}))}catch(t){}})),s(this,"$off",(function(t,e){if(i.event[t])if(e){var s=i.event[t].indexOf(e);s>-1&&i.event[t].splice(s,1)}else i.event[t].length=0})),this.event={},this.FinshDocRead=this.FinshDocRead.bind(this),this.zip=new JSZip,this.readFromZip=new dt}return i(e,[{key:"read",value:function(t){this.blob=t,this.readFromZip.SetBlob(t),this.readOfdXml()}},{key:"readOfdXml",value:function(){try{var t=this.readFromZip.readFile();this.ofd=new mt;var e=this;t.then((function(t){e.ofd.ParseFromXml(t),e.FinshDocRead()}))}catch(t){}}},{key:"FinshDocRead",value:function(){this.$emit("DocumentChange",this)}}]),e}(),vt=function(){function e(i){t(this,e),this.easyOFD=i,this.doc=i.doc,this.pageNow=1}return i(e,[{key:"Draw",value:function(t){this.docBody=this.doc.ofd.docBody[0];var e=this.docBody.docRoot.pages.page[this.pageNow-1];this.AllPageNo=this.docBody.docRoot.pages.page.length;var i=this.docBody.docRoot.commonData.GetTemplatePageByID(e.template[0].templateID);null!=i&&i.Draw(t),null!=e&&e.Draw(t);var s=this.docBody.signatures;null!=s&&s.Draw(t,e.id)}},{key:"SetPage",value:function(t){this.pageNow=t}},{key:"GetAllPageNo",value:function(){AllPageNo}},{key:"GetPagePhysicalBox",value:function(){this.docBody=this.doc.ofd.docBody[0];var t=this.docBody.docRoot.pages.page[this.pageNow-1];if(null!=t&null!=t.area&null!=t.area.physicalBox)return t.area.physicalBox;var e=this.docBody.docRoot.commonData.GetTemplatePageByID(t.template[0].templateID);return null!=e.page.area.physicalBox?e.page.area.physicalBox:this.docBody.docRoot.commonData.pageArea.physicalBox}}]),e}(),gt=function(){function e(i,s){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:300,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:150;t(this,e),this.id=i,this.x=n,this.y=a,this.width=r,this.height=o,this.parent=s,this.zoomSize=1,this.WrapperCanvas(i,r,o),this.doc=new pt,this.view=new vt(this),this.SelectFile.bind(this),this.OpenFile.bind(this),this.doc.$on("DocumentChange",this.DocumentChange.bind(this)),this.canvasSelectFile.addEventListener("change",this.SelectFile.bind(this))}return i(e,[{key:"WrapperCanvas",value:function(){this.rootdiv=document.createElement("div"),this.rootdiv.tabindex="0",this.rootdiv.id=this.id,this.parent.appendChild(this.rootdiv),this.wrapperToolsBar(),this.wrapperCanvas()}},{key:"wrapperCanvas",value:function(){this.canvasdiv=document.createElement("div"),this.canvasdiv.setAttribute("style","display: flex;justify-content: center ;padding: 10px 0 10px 0;background-color: gray;max-height:1000px;overflow:auto"),this.rootdiv.appendChild(this.canvasdiv),this.canvas=document.createElement("canvas"),this.canvasdiv.appendChild(this.canvas),this.canvas.id=this.id+"-ofd-canvas",this.ctx=this.canvas.getContext("2d");var t=window.devicePixelRatio,e=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1;this.ratio=t/e,this.canvas.width=(parseInt(this.width)*this.zoomSize||document.documentElement.clientWidth)*this.ratio,this.canvas.height=(parseInt(this.height)*this.zoomSize||document.documentElement.clientHeight)*this.ratio,this.canvas.style.width=(parseInt(this.width)*this.zoomSize||document.documentElement.clientWidth)+"px",this.canvas.style.height=(parseInt(this.height)*this.zoomSize||document.documentElement.clientHeight)+"px",this.canvas.style.backgroundColor="white",this.ctx.scale(this.ratio*this.zoomSize,this.ratio*this.zoomSize),this.WrapperPPI(this.id),this.WrapperSelectFile(this.id,this.canvasdiv)}},{key:"wrapperToolsBar",value:function(){this.toolBar=document.createElement("div"),this.toolBar.setAttribute("style","align-items: center;display: flex;justify-content: center ;padding: 10px 0 10px 0;"),this.rootdiv.appendChild(this.toolBar),this.selectButton=document.createElement("div"),this.selectButton.id=this.id+"selectButton",this.selectButton.innerText="打开",this.selectButton.className="OfdButton OpenFile",this.selectButton.addEventListener("click",this.OpenFile.bind(this)),this.toolBar.appendChild(this.selectButton),this.firstPage=document.createElement("div"),this.firstPage.id=this.id+"firstPage",this.firstPage.innerText="|<",this.firstPage.className="OfdButton firstPage",this.firstPage.addEventListener("click",this.FirstPage.bind(this)),this.toolBar.appendChild(this.firstPage),this.prePage=document.createElement("div"),this.prePage.id=this.id+"prePage",this.prePage.innerText="<",this.prePage.className="OfdButton prePage",this.prePage.addEventListener("click",this.PrePage.bind(this)),this.toolBar.appendChild(this.prePage),this.nowPage=document.createElement("div"),this.nowPage.id=this.id+"nowPage",this.nowPage.innerText="1/1",this.nowPage.className="OfdButton nowPage",this.toolBar.appendChild(this.nowPage),this.nextPage=document.createElement("div"),this.nextPage.id=this.id+"nextPage",this.nextPage.innerText=">",this.nextPage.className="OfdButton nextPage",this.nextPage.addEventListener("click",this.NextPage.bind(this)),this.toolBar.appendChild(this.nextPage),this.lastPage=document.createElement("div"),this.lastPage.id=this.id+"lastPage",this.lastPage.innerText=">|",this.lastPage.className="OfdButton lastPage",this.lastPage.addEventListener("click",this.LastPage.bind(this)),this.toolBar.appendChild(this.lastPage),this.zoomIn=document.createElement("div"),this.zoomIn.id=this.id+"zoomIn",this.zoomIn.innerText="缩小",this.zoomIn.className="OfdButton zoomIn",this.zoomIn.addEventListener("click",this.ZoomIn.bind(this)),this.toolBar.appendChild(this.zoomIn),this.zoomValue=document.createElement("div"),this.zoomValue.id=this.id+"zoomValue",this.zoomValue.innerText="100%",this.zoomValue.className="OfdButton zoomValue",this.toolBar.appendChild(this.zoomValue),this.zoomOut=document.createElement("div"),this.zoomOut.id=this.id+"zoomOut",this.zoomOut.innerText="放大",this.zoomOut.className="OfdButton zoomOut",this.zoomOut.addEventListener("click",this.ZoomOut.bind(this)),this.toolBar.appendChild(this.zoomOut)}},{key:"FirstPage",value:function(){1!=this.view.pageNow&&(this.view.pageNow=1,this.DocumentChange())}},{key:"PrePage",value:function(){this.view.pageNow>1&&(this.view.pageNow=this.view.pageNow-1,this.DocumentChange())}},{key:"NextPage",value:function(){this.view.pageNow<this.view.AllPageNo&&(this.view.pageNow=this.view.pageNow+1,this.DocumentChange())}},{key:"LastPage",value:function(){this.view.pageNow!=this.view.AllPageNo&&(this.view.pageNow=this.view.AllPageNo,this.DocumentChange())}},{key:"ZoomIn",value:function(){this.zoomSize=this.zoomSize-.1,this.zoomValue.innerText=parseInt(100*this.zoomSize)+"%",this.scaleCanvas(this.zoomSize)}},{key:"ZoomOut",value:function(){this.zoomSize=this.zoomSize+.1,this.zoomValue.innerText=parseInt(100*this.zoomSize)+"%",this.scaleCanvas(this.zoomSize)}},{key:"scaleCanvas",value:function(t){this.zoomSize=t,this.ctx.save(),this.SetPhyViewZoom(),this.Draw(),this.ctx.restore()}},{key:"OpenFile",value:function(){this.canvasSelectFile.click()}},{key:"SetPhyViewZoom",value:function(){var t=document.getElementById(this.id);t&&t.remove();var e=this.view.GetPagePhysicalBox();this.width=this.ToPX(e.w),this.height=this.ToPX(e.h),this.WrapperCanvas(),t&&this.canvasSelectFile.addEventListener("change",this.SelectFile.bind(this))}},{key:"DocumentChange",value:function(t){this.SetPhyViewZoom(),this.Draw()}},{key:"Draw",value:function(){this.view.Draw(this.ctx),this.nowPage.innerText=this.view.pageNow+"/"+this.view.AllPageNo,this.zoomValue.innerText=parseInt(100*this.zoomSize)+"%"}},{key:"WrapperPPI",value:function(t){var e=document.createElement("div");e.id=t+"-ppi",e.style="width:1in;visible:hidden;padding:0px",this.canvasdiv.appendChild(e),this.ppi=document.getElementById(t+"-ppi").offsetWidth,this.canvas.ppi=this.ppi}},{key:"WrapperSelectFile",value:function(t,e){this.canvasSelectFile=document.createElement("input"),e.appendChild(this.canvasSelectFile),this.canvasSelectFile.id=t+"-ofd-selectfile",this.canvasSelectFile.type="file",this.canvasSelectFile.accept=".ofd",this.canvasSelectFile.style="display:none"}},{key:"SelectFile",value:function(t){try{var e=t.target.files[0];this.filename=e.name,this.doc.read(e)}catch(t){}}},{key:"loadFromBlob",value:function(t){try{this.doc.read(t)}catch(t){}}},{key:"ToPX",value:function(t){return parseFloat(parseFloat(t)/25.4*96)}}]),e}();window.EasyOFD=gt}();
